<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>サイト内検索｜鷹原高校</title>
  <link rel="stylesheet" href="assets/site.css?v=2024-10-01" />
</head>
<body>
  
  <header class="topnav" role="banner">
    <div class="inner">
      <a class="brand" href="index.html" aria-label="鷹原高校 トップへ">
        <span class="mark" aria-hidden="true"></span>
        <span class="t">
          <b>鷹原（たかはら）高等学校</b>
          <small>公式サイト（検索）</small>
        </span>
      </a>

      <nav class="navlinks" aria-label="主要メニュー">
        <a href="#news">お知らせ</a>
        <a href="#guide">学校案内</a>
        <a href="#life">スクールライフ</a>
        <a href="student_council.html">生徒会</a>
        <a href="#downloads">配布資料</a>
        <a href="#links">過去サイト</a>
      
      <form class="nav-search" action="search.html" method="get" role="search">
        <input type="search" name="q" placeholder="サイト内検索" aria-label="サイト内検索" />
      </form>

    
        
      </nav>
    </div>
  </header>


  <main class="wrap">
    <section class="card">
      <h1 style="margin:0 0 10px;font-size:20px">サイト内検索</h1>
      <p class="small" style="margin:0 0 14px">キーワードを入力すると、該当ページへのリンクを表示します。</p>

      <form class="searchbox" action="search.html" method="get">
        <input type="search" name="q" placeholder="例：生徒会 / 文化祭 / 理科準備室" aria-label="検索キーワード" />
        <button class="btn" type="submit">検索</button>
      </form>

      <div id="result" style="margin-top:14px"></div>
    </section>
  </main>

  

<script>
  const items = [
    {title:"お知らせ（トップ）", url:"index.html#news", text:"更新 案内 連絡"},
    {title:"学校案内（トップ）", url:"index.html#guide", text:"校長 理科教員 連絡先"},
    {title:"スクールライフ（トップ）", url:"index.html#life", text:"行事 部活動 時程"},
    {title:"配布資料（トップ）", url:"index.html#downloads", text:"PDF 申請書 抜粋"},
    {title:"生徒会ページ", url:"student_council.html", text:"役員 行事案内 意見箱"},
    {title:"裏掲示板", url:"urabbs.html", text:"文化祭 体育館 空調 写真部 理科準備室 人体模型"}
  ];

  const params = new URLSearchParams(location.search);
  const q = (params.get("q") || "").trim();
  const result = document.getElementById("result");
  const inputs = document.querySelectorAll('input[name="q"]');
  inputs.forEach(i => i.value = q);

  function esc(s){ return s.replace(/[&<>"']/g, c=>({ "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;" }[c])); }

  function renderList(hits){
    result.innerHTML =
      '<ul class="searchList">' +
        hits.map(h => '<li><a href="'+h.url+'">'+esc(h.title)+'</a></li>').join("") +
      '</ul>';
  }

  function renderGhost(hit){
    document.documentElement.classList.add("ts-glitch");
    result.innerHTML = `
      <div class="hintBox">
        <div class="small">検索結果</div>
        <ul class="searchList">
          <li><a class="ghost" href="${hit.url}" data-text="${esc(hit.title)}">${esc(hit.title)}</a></li>
        </ul>
        <div class="tiny">${esc(hit.note || "")}</div>
      </div>
    `;
    setTimeout(()=>document.documentElement.classList.remove("ts-glitch"), 520);
  }

  async function run(){
    if(!q){
      result.innerHTML = '<p class="small">検索キーワードを入力してください。</p>';
      return;
    }

    // 通常検索（公開範囲のみ）
    const key = q.toLowerCase();
    const hits = items.filter(it => (it.title + " " + it.text).toLowerCase().includes(key));

    // パスワード扱い（サーバ側でのみ判定）
    try{
      const r = await fetch('ts?q=' + encodeURIComponent(q), { cache: "no-store" });
      const j = await r.json();
      if(j && j.ok && j.hits && j.hits[0]){
        renderGhost(j.hits[0]);
        return;
      }
    }catch(e){}

    if(!hits.length){
      result.innerHTML = '<p class="small">該当するページが見つかりませんでした。</p>';
    }else{
      renderList(hits);
    }
  }

  run();
</script>


</body>
</html>
